\begin{figure}[ht]
    \tikzstyle{intervalBox} = [draw = themeColor, rectangle, fill = themeColor!60, minimum width = 6em, minimum height = 2em, text = white, inner sep = .6em]

    \tikzstyle{epochBox} = [draw = themeColor, rectangle, fill = themeColor!80, minimum width = 24.15em, minimum height = 2em, text = white, inner sep = .6em]

    \begin{tikzpicture}
        \footnotesize
        \node[intervalBox] (interval1) {Interval 1};
        \foreach \x [count=\xi from 1] in {2,3,...,8}
            {
                \node[intervalBox, anchor = west] at (interval\xi.east) (interval\x) {Interval \x};
            }
        \node[intervalBox, minimum width = 1em, anchor = west] at (interval8.east) (interval9) {};

        \foreach \x in {1,2,...,8}
            {
                \node[circle, draw = themeColor, fill = white, radius = .5em] at ([yshift = .7em]interval\x.north east) (clock\x) {};
                \draw[themeColor] (clock\x.center) -- ([yshift = .4em]clock\x.center);
                \draw[themeColor] (clock\x.center) -- ([xshift = .25em]clock\x.center);
            }

        \foreach \x [count=\xi from 1] in {1,5}
            {
                \node[epochBox, anchor = north west] at ([yshift = -3em]interval\x.south west) (epoch\xi) {Epoch \xi};
                \draw[themeColor, line width = 1pt] ([yshift = -.2em]epoch\xi.south east) -- ([yshift = -1.2em]epoch\xi.south east);
                \node[draw=white, line width = .5pt, circle, fill = themeColor, inner sep = .75pt] at ([yshift = -.9em]epoch\xi.south east) (rp11) {};
                \draw[themeColor, line width = 1pt] ([xshift = -.4em, yshift = -.2em]epoch\xi.south east) -- ([xshift = -.4em, yshift = -1.2em]epoch\xi.south east);
                \node[draw=white, line width = .5pt, circle, fill = themeColor, inner sep = .75pt] at ([xshift = -.4em, yshift = -.5em]epoch\xi.south east) (rp12) {};
                \draw[themeColor, line width = 1pt] ([xshift = .4em, yshift = -.2em]epoch\xi.south east) -- ([xshift = .4em, yshift = -1.2em]epoch\xi.south east);
                \node[draw=white, line width = .5pt, circle, fill = themeColor, inner sep = .75pt] at ([xshift = .4em, yshift = -.7em]epoch\xi.south east) (rp13) {};
            }
        \node[epochBox, minimum width = 1em, minimum height = 2.05em, anchor = north west] at ([yshift = -3em]interval9.south west) (epoch3) {};

        \draw[themeColor] ([yshift = -1.5em]interval1.south west) -- ([xshift = 1.2em, yshift = -1.5em]interval8.south east);
        \node[fill = themeColor, minimum size = .66em, inner sep = 0] at ([yshift = -1.5em]interval1.south west) (block1) {};
        \foreach \x [count=\xi from 1] in {.3, .5, .7, .4, .2, .8, .2, .1, .2, .5, .7, .3, .4, .5, .2, 1, 1.3, .3, .3, 1.3, .2, .9, .05, .05, .4, .3, .2, .2, .2, .15, .5, .5, .2, .2, .2, .3, .7, .3, 1.1, .7, .3, .2, .3}
            {
                \pgfmathtruncatemacro\xii{\xi + 1}
                \node[fill = themeColor, minimum size = .66em, inner sep = 0, anchor = west] at ([xshift = \x em]block\xi.east) (block\xii) {};
            }

        \draw[line width = .5pt, themeColor, densely dotted] (interval1.south west) -- ([yshift = -3em]interval1.south west);
        \foreach \x in {1,2,...,8}
            {
                \draw[line width = .5pt, themeColor, densely dotted] (interval\x.south east) -- ([yshift = -3em]interval\x.south east);
            }

        \node[fill = white, rectangle, minimum width = 1em, minimum height = 7.5em, anchor = north west] at ([xshift = 1em, yshift = .2em]interval8.north east) (shade) {};

        \node[fill = themeColor, minimum size = .66em, inner sep = 0, anchor = north] at ([yshift = -3em]epoch1.south east) (blockex) {};
        \node[text = themeColor, anchor = west, inner sep = 0] at ([xshift = .2em]blockex.east) (blockextext) {\tiny Block};
        \node[circle, draw = themeColor, fill = white, radius = .5em, anchor = west] at ([xshift = .5em]blockextext.east) (clockex) {};
        \draw[themeColor] (clockex.center) -- ([yshift = .4em]clockex.center);
        \draw[themeColor] (clockex.center) -- ([xshift = .25em]clockex.center);
        \node[text = themeColor, anchor = west, inner sep = 0] at ([xshift = .2em]clockex.east) (clockextext) {\tiny Local Clock Adjustment};
        \draw[themeColor, line width = 1pt] ([xshift = 1em, yshift = .5em]clockextext.east) -- ([xshift = 1em, yshift = -.5em]clockextext.east);
        \node[draw=white, line width = .5pt, circle, fill = themeColor, inner sep = .75pt] at ([xshift = 1em, yshift = -.2em]clockextext.east) (rpex1) {};
        \draw[themeColor, line width = 1pt] ([xshift = .6em, yshift = .5em]clockextext.east) -- ([xshift = .6em, yshift = -.5em]clockextext.east);
        \node[draw=white, line width = .5pt, circle, fill = themeColor, inner sep = .75pt] at ([xshift = .6em, yshift = .2em]clockextext.east) (rpex2) {};
        \draw[themeColor, line width = 1pt] ([xshift = 1.4em, yshift = .5em]clockextext.east) -- ([xshift = 1.4em, yshift = -.5em]clockextext.east);
        \node[draw=white, line width = .5pt, circle, fill = themeColor, inner sep = .75pt] at ([xshift = 1.4em, yshift = 0em]clockextext.east) (rpex3) {};
        \node[text = themeColor, anchor = west, inner sep = 0] at ([xshift = 1.9em]clockextext.east) (retargettext) {\tiny Target Recalculation Point};
        \node[text = themeColor, anchor = east, inner sep = 0] at ([xshift = -.5em]blockex.west) (epochextext) {\tiny Target Recalculation Epoch};
        \node[draw = themeColor, rectangle, fill = themeColor!80, minimum size = 1em, inner sep = 0, anchor = east] at ([xshift = -.2em]epochextext.west) (epochex) {};
        \node[text = themeColor, anchor = east, inner sep = 0] at ([xshift = -.5em]epochex.west) (intervalextext) {\tiny Clock Synchronization Interval};
        \node[draw = themeColor, rectangle, fill = themeColor!60, minimum size = 1em, inner sep = 0, anchor = east] at ([xshift = -.2em]intervalextext.west) (intervalex) {};

        \begin{scope}[on background layer]
            \node[fit = (intervalex) (retargettext), draw = themeColor, rectangle, inner sep = .4em] (scope1) {};
        \end{scope}
    \end{tikzpicture}

    \caption{An illustration of the clock synchronization protocol execution with one target recalculation epoch consisting of four clock synchronization intervals.}
    \label{fig:protocol-execution}
\end{figure}